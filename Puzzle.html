<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <meta http-equiv="refresh" content="0.2" /> -->
    <!-- Ссылка на файл со стилями css -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/puzzle.css">
    <title>Верстка и прототипирование сайтов: Сайт продажи мебели</title>
</head>
<body>
    <!-- header -->
    <header>
        <div class="header-container wrapper container">
            <!-- Логотип и название компании, логотип сделан с помощью css -->
            <div class="header-logo wrapper">
                <!-- Логотип -->
                <div class="logo lamp">
                    <div class="rect-1"></div>
                    <div class="rect-3"></div>
                    <div class="base"></div>
                    <div class="rect-2"></div>
                    <div class="circle-1"></div>
                    <div class="rect-4"></div>
                    <div class="light"></div>
                    <div class="trapezoid"></div>
                </div>
                <!-- Название компании -->
                <b class="company-name text">Table lamp</b>
            </div>
            <!-- Меню навигации сайта -->
            <nav class="header-nav">
                <div class="header-nav-el"><a class="header-nav-link text" href="">Главная страница</a></div>
                <div class="header-nav-el"><a class="header-nav-link text" href="">Продукты</a></div>
                <div class="header-nav-el"><a class="header-nav-link text" href="">О нас</a></div>
                <div class="header-nav-el"><a class="header-nav-link text" href="">Партнеры</a></div>
                <div class="header-nav-el"><a class="header-nav-link text" href="">Контакты</a></div>
            </nav>
            <div class="registration"><a class="text" href="">Регистрация</a></div>
        </div>
        <div class="task-wrapper">
            <nav class="header-nav">
                <div class="header-nav-el"><a class="header-nav-link text" href="./index.html">Главная страница</a></div>
                <div class="header-nav-el"><a class="header-nav-link text" href="./CSS_IMG.html">CSS img</a></div>
                <div class="header-nav-el"><a class="header-nav-link text" href="./Flexbox.html">Flexbox</a></div>
                <div class="header-nav-el"><a class="header-nav-link text" href="./DOM.html">DOM</a></div>
                <div class="header-nav-el"><a class="header-nav-link text" href="./Puzzle.html">Puzzle</a></div>
                <div class="header-nav-el"><a class="header-nav-link text" href="./Game/index.html">Проект</a></div>
            </nav>
        </div>
        
    </header>
    
    <main>
        <!-- Основное тело сайта -->
        <div class="main-content container">
            <div style="text-align: center; color: #fff;">Вариант 3</div>
            
            <div class="puzzle-container">
                <div class="example"></div>
                <div class="owl">
                    <div class="ears">
                            <div class="ear-1 puzzle-item ear" id="ear-1"></div>
                            <div class="ear-2 puzzle-item ear" id="ear-2"></div>
                    </div>
                    <div class="head puzzle-item" id="head">
                        <div class="nose"></div>
                    </div>
                    <div class="eyes">
                        <div class="eye-1 puzzle-item eye" id="eye-1">
                            <div class="pupil">
                                <div class="pupil_ref"></div>
                            </div>
                        </div>
                        <div class="eye-2 puzzle-item eye" id="eye-2">
                            <div class="pupil">
                                <div class="pupil_ref"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
    </main>
    <!-- footer -->
    <footer class="footer-wrapper">
        <!-- Элементы footer -->
        <div class="footer-container wrapper container">
            <!-- Краткая информация о компании -->
            <div class="about text footer-el">
                О компании
                <hr>
                <div class="text">
                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Reiciendis quas a ea adipisci rerum aspernatur, mollitia dolore suscipit ipsam velit excepturi temporibus molestias sequi! Illo iure pariatur atque maxime dicta.
                </div>
            </div>
            <!-- Ссылки на социальные сети -->
            <div class="social-networks text footer-el">
                Ссылки на соц.сети
                <hr>
                <div class="social-networks-container">
                    <a href="">
                        <img src="img/SVG white/Telegram_white.svg" alt="Telegram" class="img">
                    </a>
                    <a href="">
                        <img src="img/SVG white/VK_white.svg" alt="VK" class="img">
                    </a>
                    <a href="">
                        <img src="img/SVG white/YouTube_white.svg" alt="YouTube" class="img">
                    </a>
                </div>
            </div>
            <!-- Физический адрес компании -->
            <div class="address text footer-el">
                Адрес компании
                <hr>
                <div class="address-content text">
                    <p>г. Зеленоград</p>
                    <p>ул. Пушкина</p>
                    <p>д. 23</p>
                    <p>Россия</p>
                </div>
            </div>
        </div>
        <div class="author text">
            2023 Алан Алеев
        </div>
    </footer>
    <script>
        let puzzleItems = document.querySelectorAll('.puzzle-item');
        let head_1 = document.getElementById("head");
        let eye_1 = document.getElementById('eye-1');
        let eye_2 = document.getElementById('eye-2');
        let ear_1 = document.getElementById('ear-1');
        let ear_2 = document.getElementById('ear-2');
        let field = document.querySelectorAll('.puzzle-container');
        let fieldCanv = field[0];
        let fieldLeft = fieldCanv.getBoundingClientRect().left;
        let fieldRight = fieldCanv.getBoundingClientRect().right;
        let fieldTop = fieldCanv.getBoundingClientRect().top;
        let fieldBottom = fieldCanv.getBoundingClientRect().bottom;

        puzzleItems.forEach((el) => {
            el.addEventListener("click", (event) =>{
                rotate(event, el);
            });
            el.addEventListener("mousedown", (event) =>{
                getCursorPosition(el, event);
                if(!event.shiftKey){
                    //Возвращение координат минимально возможного прямоугольника для выбранного элемента
                    let X = event.clientX - el.getBoundingClientRect().left;
                    let Y = event.clientY - el.getBoundingClientRect().top;
                    //функция обработки движения мыши определяется внутри т.к. необходимы инициализированные переменные координат
                    document.onmousemove = function (event) {
                        if(event.pageX - X < fieldLeft){
                            el.style.left = fieldLeft + 'px';
                        } else if(event.pageX > fieldRight){
                            el.style.left = fieldRight - el.getBoundingClientRect().width + 'px';
                        } else {
                            el.style.left = event.pageX - X + 'px';
                        }
                        if(event.pageY - Y < fieldTop){
                            el.style.top = fieldTop + 'px';
                        } else if(event.pageY> fieldBottom){
                            el.style.top = fieldBottom - el.getBoundingClientRect().height + 'px';
                        } else {
                            el.style.top = event.pageY - Y + 'px';
                        }
                        
                    }
                }
            });
            el.addEventListener("mouseup", (event) =>{
                if(!event.shiftKey){
                    el.onmouseup = null;
                    document.onmousemove = null;
                    if(checkItemField(puzzleItems)){
                        let eyes = document.querySelectorAll('.eye');
                        eyes.forEach((e) => {
                            e.style.animation = 'owl_eyes 1s linear infinite alternate 1s forwards';
                        })
                    };
                }
            });
            el.addEventListener("dragstart", (event) =>{
                if(!event.shiftKey){
                    return false;
                }
            });
        });

        

        function rotate(event, el) {
            if (event.shiftKey && el.classList[2]=="ear"){
                let deg = getDeg(el);
                deg += 90;
                deg = deg%360;
                el.style.transform = 'rotate(' + deg + 'deg)'; 
            }
        }

        function getDeg(el) {
            //Получение стилей выбранного элемента
            let style = window.getComputedStyle(el, null);
            //Получение стиля типа transform в виде матрицы, где первый элемент cos, а второй sin
            let styleMatrix = style.getPropertyValue("transform");
            if (styleMatrix == 'none') return 0;
            let transformArr = styleMatrix.split('(')[1];
            transformArr = transformArr.split(')')[0];
            transformArr = transformArr.split(',');
            transformArr = transformArr.slice(0,2);
            let cos = transformArr[0];
            let sin = transformArr[1];
            //Math.asin высчитывание значения между диапазоном pi/2 -pi/2
            let deg = Math.round(Math.asin(sin)/ Math.PI * (180));

            if (cos < 0) {
                let addDeg = 180 - Math.round(Math.asin(sin)/ Math.PI * (180));
                deg = addDeg;
            }
            if (deg < 0) {
                deg = 360 + deg;
            }
            return deg;
        }
        function getCursorPosition(el, event) {
            const rect = el.getBoundingClientRect()
            const x = event.clientX - rect.left
            const y = event.clientY - rect.top
        }
        
        function checkRotation() {
            let flag = true;
            puzzleItems.forEach((el)=>{
                if(!(getDeg(el)==0)){
                    flag = false;
                }
            })
            return flag;
        }

        function checkItemField(puzzles) {
            let eye1, eye2, head, ear1, ear2 = null;
            let temp;
            let tempCanv;
            puzzles.forEach((el)=>{
                let className = el.classList[0]
                switch (el.classList[0]){
                    case "head":
                        temp = document.getElementsByClassName(`head`);
                        tempCanv = temp[0];
                        head = tempCanv.getBoundingClientRect();
                        break;
                    case "eye-1":
                        temp = document.getElementsByClassName(`${className}`);
                        tempCanv = temp[0];
                        eye1 = tempCanv.getBoundingClientRect();
                        
                        break;
                    case "eye-2":
                        temp = document.getElementsByClassName(`${className}`);
                        tempCanv = temp[0];
                        eye2 = tempCanv.getBoundingClientRect();
                        
                        break;
                    case "ear-1":
                        temp = document.getElementsByClassName(`${className}`);
                        tempCanv = temp[0];
                        ear1 = tempCanv.getBoundingClientRect();
                        
                        break;
                    case "ear-2":
                        temp = document.getElementsByClassName(`${className}`);
                        tempCanv = temp[0];
                        ear2 = tempCanv.getBoundingClientRect();
                        
                        break;
                    default:
                        break;
                }
            })
            temp = document.getElementsByClassName('eye');
                
            if (!((eye1.top > head.top) && (eye1.left > head.left) && (eye1.bottom < head.bottom) && (eye1.right < head.right))) {
                console.log("First fail")
                
                return;
            }
            console.log("First success")
            if (!((eye2.top > head.top) && (eye2.left > head.left) && (eye2.bottom < head.bottom) && (eye2.right < head.right))) {
                console.log("Second fail")
                return;
            }
            console.log("Second Success")
            if (!((eye1.top + 10 >= eye2.top) && (eye1.top - 10 <= eye2.top))) {
                console.log("Third fail")
                return;
            }
            
            eye_1.style.left = head_1.getBoundingClientRect().left + 25 + 'px';
            eye_1.style.top = head_1.getBoundingClientRect().top + 25 + 'px';

            eye_2.style.left = head_1.getBoundingClientRect().left + 80 + 'px';
            eye_2.style.top = head_1.getBoundingClientRect().top + 25 + 'px';
            console.log("Third Success")
            if (!(checkRotation())){
                return;
            }
            if (!((ear1.bottom - 14 > head.top) && (ear1.left+14 < head.right) && (ear1.top - 14 < head.top) && (ear1.right > head.right))) {
                console.log("Fourth fail")
                return;
            }
            ear_1.style.left = head_1.getBoundingClientRect().left + 110 + 'px';
            ear_1.style.top = head_1.getBoundingClientRect().top - 12 + 'px';
            console.log("Fourth Success")
            if (!((ear2.bottom - 14 > head.top) && (ear2.right-14 > head.left) && (ear2.top - 14 < head.top) && (ear2.left < head.left))) {
                console.log("Fiveth fail")
                return;
            }
            ear_2.style.left = head_1.getBoundingClientRect().left -15 + 'px';
            ear_2.style.top = head_1.getBoundingClientRect().top - 12 + 'px';
            console.log("Fiveth Success")
            return true;
           
        }
    </script>
</body>
</html>


